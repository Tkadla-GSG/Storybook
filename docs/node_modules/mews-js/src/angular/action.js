import noop from 'lodash/noop';

export default function actionFactoryProvider(withLoader) {
    actionFactory.$inject = ['$timeout', 'ErrorHandler'];

    function actionFactory($timeout, errorHandler) {
        return function action(promise, callback = noop, errorCallback = noop) {
            withLoader(promise)
                .then((...args) => $timeout(callback(...args)))
                .catch(err => {
                    errorHandler(err);
                    errorCallback(err);
                });
        };
    }

    return actionFactory;
}
