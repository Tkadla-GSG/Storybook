import EventEmitter from 'eventemitter3';

var event = {
    TAKE: 'take',
    LEAVE: 'leave',
};

export default function semaphore(capacity = 1) {
    var emitter = new EventEmitter();
    var pending = 0;

    return {
        take() {
            if (pending < capacity) {
                emitter.emit(event.TAKE);
            }
            ++pending;
        },

        leave() {
            --pending;
            if (pending < capacity) {
                emitter.emit(event.LEAVE);
            }
        },

        onTake(callback) {
            emitter.on(event.TAKE, callback);
        },

        onLeave(callback) {
            emitter.on(event.LEAVE, callback);
        },
    };
}
