import _ from 'lodash';
import { type } from '../../../utils';
import { DataComponent } from '../data';
import Culture from './culture';

export default function CultureComponent(dataComponent) {
    type.check(dataComponent, DataComponent);

    const cultures = {};

    return type.create(CultureComponent, {
        getByCode(code) {
            if (!cultures[code]) {
                const cultureData = _.find(dataComponent.getCultures(), c => c.code === code);

                if (!cultureData) {
                    throw new Error(`Unknown culture: "${code}"`);
                }

                cultures[code] = Culture(cultureData);
            }

            return cultures[code] || null;
        },

        getAll() {
            const culturesData = dataComponent.getCultures();
            if (_.size(cultures) !== _.size(culturesData)) {
                const missingCulturesData = _.reject(culturesData, c => cultures[c.code]);
                _.each(missingCulturesData, c => (cultures[c.code] = Culture(c)));
            }

            return cultures;
        },
    });
}
