import _ from 'lodash';
import { check } from '../../../utils';

export default function manipulable(factory, toMoment, parts = []) {
    const add = partName => (date, number) => {
        check.number(number);

        const m = toMoment(date).add(number, partName);
        return factory(m);
    };

    const diff = partName => (date1, date2) => {
        check.sameTimezones(date1, date2);
        return toMoment(date1).diff(toMoment(date2), partName);
    };

    return _.reduce(parts, (operations, p) => _.assign(operations, {
        ['add' + p.value]: add(_.lowerCase(p.value)),
        ['diff' + p.value]: diff(_.lowerCase(p.value)),
    }), {});
}
