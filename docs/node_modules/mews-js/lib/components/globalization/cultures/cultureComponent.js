'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = CultureComponent;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _utils = require('../../../utils');

var _data = require('../data');

var _culture = require('./culture');

var _culture2 = _interopRequireDefault(_culture);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function CultureComponent(dataComponent) {
    _utils.type.check(dataComponent, _data.DataComponent);

    var cultures = {};

    return _utils.type.create(CultureComponent, {
        getByCode: function getByCode(code) {
            if (!cultures[code]) {
                var cultureData = _lodash2.default.find(dataComponent.getCultures(), function (c) {
                    return c.code === code;
                });

                if (!cultureData) {
                    throw new Error('Unknown culture: "' + code + '"');
                }

                cultures[code] = (0, _culture2.default)(cultureData);
            }

            return cultures[code] || null;
        },
        getAll: function getAll() {
            var culturesData = dataComponent.getCultures();
            if (_lodash2.default.size(cultures) !== _lodash2.default.size(culturesData)) {
                var missingCulturesData = _lodash2.default.reject(culturesData, function (c) {
                    return cultures[c.code];
                });
                _lodash2.default.each(missingCulturesData, function (c) {
                    return cultures[c.code] = (0, _culture2.default)(c);
                });
            }

            return cultures;
        }
    });
}