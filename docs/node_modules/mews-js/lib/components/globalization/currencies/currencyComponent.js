'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = CurrencyComponent;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _utils = require('../../../utils');

var _data = require('../data');

var _currency = require('./currency');

var _currency2 = _interopRequireDefault(_currency);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function CurrencyComponent(dataComponent) {
    _utils.type.check(dataComponent, _data.DataComponent);

    var currencies = {};

    return _utils.type.create(CurrencyComponent, {
        getByCode: function getByCode(code) {
            if (!currencies[code]) {
                var currencyData = _lodash2.default.find(dataComponent.getCurrencies(), function (c) {
                    return c.code === code;
                });

                if (!currencyData) {
                    throw new Error('Unknown currency: "' + code + '"');
                }

                currencies[code] = (0, _currency2.default)(currencyData);
            }

            return currencies[code] || null;
        },
        getAll: function getAll() {
            var currenciesData = dataComponent.getCurrencies();
            if (_lodash2.default.size(currencies) !== _lodash2.default.size(currenciesData)) {
                var missingCurrenciesData = _lodash2.default.reject(currenciesData, function (c) {
                    return currencies[c.code];
                });
                _lodash2.default.each(missingCurrenciesData, function (c) {
                    return currencies[c.code] = (0, _currency2.default)(c);
                });
            }

            return currencies;
        }
    });
}