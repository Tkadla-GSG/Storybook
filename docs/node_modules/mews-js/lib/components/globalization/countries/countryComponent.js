'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = CountryComponent;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _utils = require('../../../utils');

var _data = require('../data');

var _country = require('./country');

var _country2 = _interopRequireDefault(_country);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function CountryComponent(dataComponent) {
    _utils.type.check(dataComponent, _data.DataComponent);

    var countries = {};

    return _utils.type.create(CountryComponent, {
        getByCode: function getByCode(code) {
            if (!countries[code]) {
                var countryData = _lodash2.default.find(dataComponent.getCountries(), function (c) {
                    return c.code === code;
                });

                if (!countryData) {
                    throw new Error('Unknown country: "' + code + '"');
                }

                countries[code] = (0, _country2.default)(countryData);
            }

            return countries[code] || null;
        },
        getAll: function getAll() {
            var countriesData = dataComponent.getCountries();
            if (_lodash2.default.size(countries) !== _lodash2.default.size(countriesData)) {
                var missingCountriesData = _lodash2.default.reject(countriesData, function (c) {
                    return countries[c.code];
                });
                _lodash2.default.each(missingCountriesData, function (c) {
                    return countries[c.code] = (0, _country2.default)(c);
                });
            }

            return countries;
        }
    });
}