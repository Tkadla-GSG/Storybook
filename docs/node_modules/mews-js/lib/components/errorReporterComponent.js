'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = ErrorReporterComponent;

var _set = require('core-js/library/es6/set');

var _set2 = _interopRequireDefault(_set);

var _utils = require('../utils');

var _loggerComponent = require('./loggerComponent');

var _loggerComponent2 = _interopRequireDefault(_loggerComponent);

var _sentryComponent = require('./sentryComponent');

var _sentryComponent2 = _interopRequireDefault(_sentryComponent);

var _errors = require('../errors');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var errorWhiteList = new _set2.default([_errors.NotAuthorizedError, _errors.BusinessError, _errors.NetworkError]);

function ErrorReporterComponent(loggerComponent, sentryComponent) {
    _utils.type.check(loggerComponent, _loggerComponent2.default);
    _utils.type.check(sentryComponent, _sentryComponent2.default);

    return _utils.type.create(ErrorReporterComponent, {
        report: report,

        withErrorReporting: function withErrorReporting(promise) {
            return Promise.resolve().then(promise).catch(function (error) {
                report(error);
                throw error;
            });
        },
        setPerson: function setPerson(person) {
            sentryComponent.setPerson(person);
        }
    });

    function report(error) {
        var additionalData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        loggerComponent.log(error, additionalData);

        if (error && !errorWhiteList.has(error.constructor)) {
            sentryComponent.logError(error, additionalData);
        }
    }
}